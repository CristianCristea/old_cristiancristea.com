var app={CreateContact:function(t,e,a,n){this.name=t,this.email=e,this.address=a,this.id=n},createNewContact:function(t,e,a,n){var o=new this.CreateContact(t,e,a,n);localStorage.setItem("contactCount",o.id);var i=localStorage.contactCount;this.commitToStorage(i,o)},commitToStorage:function(t,e){var a="contact"+t;localStorage.setItem("contactCount",t),localStorage.setItem(a,JSON.stringify(e))},getContactFromStorage:function(t){return JSON.parse(localStorage.getItem("contact"+t))},displayElem:function(t){$("li").each(function(e,a,n){t.indexOf($(this).find(".name").text().toLowerCase())===-1?$(this).hide():$(this).show()})},identifyKey:function(t){return t.which>=97&&t.which<=122},searchName:function(t,e){var a=function(t){var a=t.slice(0,e.length);return a===e};return t.filter(a)},showForm:function(){$("main").slideUp(300),$(".add-contact-form").slideDown(400)},hideForm:function(){$("main").slideDown(400),$(".add-contact-form").slideUp(300)},getContactData:function(t){var e=$(t.currentTarget).closest("li"),a=e.find(".name").text(),n=e.find(".email").text(),o=e.find(".address").text();$(".add-contact-form form").addClass("editing"),$("#name").val(a),$("#email").val(n),$("#address").val(o),$("#current_id").attr("data-id",e.attr("data-id")),this.showForm()},updateContactInStorage:function(t){return t.name=$("#name").val(),t.email=$("#email").val(),t.address=$("#address").val(),t},updateContactView:function(t){var e=$('li[data-id="'+t+'"]'),a=$("#name").val(),n=$("#email").val(),o=$("#address").val();e.find(".name").text(a),e.find(".email").text(n),e.find(".address").text(o),console.log("updated")},editContact:function(t){var e=this.getContactFromStorage(t),a=this.updateContactInStorage(e);this.commitToStorage(t,a)},deleteContact:function(t,e){var a=$("li").filter(function(){return $(this).attr("data-id")==e});a.remove(),localStorage.removeItem("contact"+e)},clearForm:function(t){$(t.target).find("input").not(":hidden").val(""),$(t.target).removeClass("editing")},newContact:function(t,e,a,n){this.createNewContact(t,e,a,n)},renderContact:function(t){var e=$("#contact").html(),a=this.getContactFromStorage(t),n=Handlebars.compile(e),o=n({contact:a});$("#contacts").append(o)},renderContacts:function(t){for(var e=1;e<=+t.getItem("contactCount");e++)this.getContactFromStorage(e)&&this.renderContact(e)},incrementId:function(t){return Number(++t)},init:function(){var t=this,e=$(".add-contact-form form");$('[type="submit"]');0!==localStorage.length&&$('input[type="hidden"]').val(localStorage.getItem("contactCount")),$("#add_contact_btn").on("click",function(e){t.showForm()}),$('button[type="reset"]').on("click",function(a){t.hideForm(),e.removeClass("editing")}),e.submit(function(a){a.preventDefault();var n=$('input[type="hidden"]').val(),o=$("#name").val(),i=$("#email").val(),c=$("#address").val();if(e.hasClass("editing")){var r=$("#current_id").attr("data-id");t.editContact(r),t.updateContactView(r)}else{$('input[type="hidden"]').val(t.incrementId(n));var d=$('input[type="hidden"]').val();t.newContact(o,i,c,d),t.renderContact(d)}t.hideForm(),t.clearForm(a)}),$("#contacts").on("click",".edit",function(e){t.getContactData(e)}),$("#contacts").on("click",".delete",function(e){var a=$(e.currentTarget).closest("li").attr("data-id");t.deleteContact(e,a)}),$('input[type="search"]').on("keyup",function(e){var a;if(!t.identifyKey)return!1;var n=[];$("li").map(function(){n.push($(this).find(".name").text().toLowerCase())}),a=t.searchName(n,$(this).val().toLowerCase()),t.displayElem(a)}),t.renderContacts(localStorage)}};$(function(){app.init()});